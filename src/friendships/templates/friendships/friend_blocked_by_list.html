{% extends "base.html" %}

{% block title %}Blocked By{% endblock %}

{% block header %}
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand" href="{% url 'common-home' %}">StrengthRankings</a>
    <button class="navbar-toggler" type="button" data-coreui-toggle="collapse" data-coreui-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="{% url 'friend_dashboard' %}">
            <i class="fas fa-arrow-left me-1"></i>Friends Dashboard
          </a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-coreui-toggle="dropdown">
            <img src="{{ user.profile.image.url }}" alt="{{ user.username }}" class="rounded-circle me-2" width="35" height="35" style="border: 2px solid var(--brand-primary);">
            <span class="fw-semibold">{{ user.username }}</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="{% url 'accounts-profile' %}"><i class="fas fa-user me-2"></i>My Profile</a></li>
            <li><a class="dropdown-item" href="{% url 'common-home' %}"><i class="fas fa-home me-2"></i>Dashboard</a></li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <form method="post" action="{% url 'accounts-logout' %}">
                {% csrf_token %}
                <button type="submit" class="dropdown-item text-danger">
                  <i class="fas fa-sign-out-alt me-2"></i>Log out
                </button>
              </form>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
{% endblock %}

{% block content %}
<div class="container">
  <!-- Page Header -->
  <section class="mb-5">
    <div class="row align-items-center">
      <div class="col-lg-8">
        <h1 class="display-title">Blocked By</h1>
        <p class="text-secondary lead">Users who have blocked you from contacting them</p>
        {% if friends_blocked_by %}
        <span class="badge bg-secondary">
          <i class="fas fa-ban me-1"></i>
          {{ friends_blocked_by|length }} user{{ friends_blocked_by|length|pluralize }} blocked you
        </span>
        {% endif %}
      </div>
      <div class="col-lg-4 text-lg-end">
        <a href="{% url 'friend_search' %}" class="btn btn-outline-secondary">
          <i class="fas fa-search me-2"></i>Find Other Friends
        </a>
      </div>
    </div>
  </section>

  <!-- Information Notice -->
  <div class="alert alert-warning mb-4" style="background: rgba(255, 210, 63, 0.1); border: 1px solid rgba(255, 210, 63, 0.3);">
    <h6 class="alert-heading mb-2">
      <i class="fas fa-info-circle me-2"></i>Limited Interaction
    </h6>
    <p class="small mb-0">
      These users have blocked you, which means you cannot send them friend requests, view their full profiles,
      or interact with them directly. This list is shown for transparency, but you cannot take any actions with these users.
    </p>
  </div>

  <div class="divider"></div>

  <!-- Blocked By Users List -->
  <section class="section">
    {% if friends_blocked_by %}
      <div class="row g-4">
        {% for blocking_user in friends_blocked_by %}
        <div class="col-12">
          <div class="card profile-card" style="border-left: 4px solid var(--text-muted); opacity: 0.7;">
            <div class="card-body">
              <div class="row align-items-center">
                <!-- User Info (Limited) -->
                <div class="col-lg-8">
                  <div class="d-flex align-items-start">
                    <div class="position-relative me-3">
                      <img src="{{ blocking_user.profile.image.url }}"
                           alt="{{ blocking_user.username }}"
                           class="rounded-circle"
                           style="width: 80px; height: 80px; object-fit: cover; filter: grayscale(100%); opacity: 0.5;">
                      <div class="position-absolute top-50 start-50 translate-middle">
                        <i class="fas fa-lock text-muted" style="font-size: 2.5rem; filter: drop-shadow(0 0 3px rgba(0,0,0,0.8));"></i>
                      </div>
                    </div>

                    <div class="flex-grow-1">
                      <h4 class="mb-1 text-muted">
                        {{ blocking_user.username }}
                        {% if blocking_user.first_name or blocking_user.last_name %}
                          <span class="text-secondary fw-normal">
                            ({{ blocking_user.first_name }} {{ blocking_user.last_name }})
                          </span>
                        {% endif %}
                      </h4>

                      <!-- Very Limited Info -->
                      <div class="d-flex gap-3 flex-wrap mb-2">
                        <span class="badge bg-dark">
                          <i class="fas fa-user me-1"></i>
                          Profile Limited
                        </span>
                      </div>

                      <!-- Block Status -->
                      <div class="text-muted small">
                        <i class="fas fa-lock me-1"></i>
                        <strong>Blocked you</strong> - You cannot interact with this user
                      </div>
                    </div>
                  </div>
                </div>

                <!-- No Actions Available -->
                <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                  <div class="d-flex flex-column gap-2">
                    <span class="badge bg-secondary mb-2">
                      <i class="fas fa-lock me-1"></i>No Actions Available
                    </span>

                    <!-- All buttons disabled -->
                    <button class="btn btn-secondary btn-sm" disabled>
                      <i class="fas fa-ban me-1"></i>Cannot Interact
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if is_paginated %}
      <nav aria-label="Page navigation" class="mt-5">
        <ul class="pagination justify-content-center">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}"
                 style="background: var(--surface); border-color: var(--brand-primary); color: var(--text-primary);">
                <i class="fas fa-chevron-left"></i>
              </a>
            </li>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
              <li class="page-item active">
                <span class="page-link" style="background: var(--gradient-primary); border-color: var(--brand-primary);">{{ num }}</span>
              </li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
              <li class="page-item">
                <a class="page-link" href="?page={{ num }}"
                   style="background: var(--surface); border-color: var(--brand-primary); color: var(--text-primary);">{{ num }}</a>
              </li>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}"
                 style="background: var(--surface); border-color: var(--brand-primary); color: var(--text-primary);">
                <i class="fas fa-chevron-right"></i>
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}

    {% else %}
      <!-- Empty State -->
      <div class="text-center py-5">
        <div class="mb-4">
          <i class="fas fa-smile text-gradient" style="font-size: 5rem;"></i>
        </div>
        <h3 class="mb-3">No One Has Blocked You</h3>
        <p class="text-secondary mb-4">
          Great news! No users have blocked you. You can freely interact with everyone in the community.
        </p>
        <div class="d-flex gap-3 justify-content-center">
          <a href="{% url 'friend_search' %}" class="btn btn-primary">
            <i class="fas fa-search me-2"></i>Find Friends
          </a>
          <a href="{% url 'friend_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-user-friends me-2"></i>View Your Friends
          </a>
        </div>
      </div>
    {% endif %}
  </section>

  <!-- Info Section -->
  <div class="divider"></div>

  <section class="section mt-5">
    <div class="card" style="background: rgba(108, 117, 125, 0.1); border: 1px solid rgba(108, 117, 125, 0.3);">
      <div class="card-body">
        <h5 class="text-secondary mb-3">
          <i class="fas fa-question-circle me-2"></i>Why Am I Blocked?
        </h5>
        <div class="row">
          <div class="col-md-6">
            <h6 class="text-gradient">Common reasons:</h6>
            <ul class="small text-secondary mb-0">
              <li>Personal preference or privacy</li>
              <li>Misunderstanding or conflict</li>
              <li>Accidental blocking</li>
              <li>They want to limit their connections</li>
            </ul>
          </div>
          <div class="col-md-6">
            <h6 class="text-gradient">What you can do:</h6>
            <ul class="small text-secondary mb-0">
              <li>Respect their decision</li>
              <li>Focus on other connections</li>
              <li>Build positive relationships</li>
              <li>Move forward positively</li>
            </ul>
          </div>
        </div>
        <div class="mt-3 p-3 rounded" style="background: rgba(0, 0, 0, 0.2);">
          <p class="small text-muted mb-0">
            <i class="fas fa-info-circle me-1"></i>
            <strong>Note:</strong> Being blocked is not necessarily personal. Users have various reasons for managing
            their connections, and it's best to respect their choices and focus on building positive relationships elsewhere.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Quick Actions -->
  <div class="text-center mt-4">
    <p class="text-secondary mb-3">Quick Navigation</p>
    <div class="d-flex gap-2 justify-content-center flex-wrap">
      <a href="{% url 'friend_dashboard' %}" class="btn btn-outline-secondary btn-sm">
        <i class="fas fa-th-large me-1"></i>Friends Dashboard
      </a>
      <a href="{% url 'friend_blocked_list' %}" class="btn btn-outline-accent btn-sm">
        <i class="fas fa-user-slash me-1"></i>Users You Blocked
      </a>
      <a href="{% url 'friend_list' %}" class="btn btn-outline-secondary btn-sm">
        <i class="fas fa-user-friends me-1"></i>My Friends
      </a>
    </div>
  </div>
</div>

<!-- Display Messages -->
{% if messages %}
  {% for message in messages %}
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
      <div id="toast-{{ forloop.counter }}" class="toast show align-items-center text-white bg-{{ message.tags }} border-0" role="alert">
        <div class="d-flex">
          <div class="toast-body">
            {{ message }}
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" onclick="document.getElementById('toast-{{ forloop.counter }}').style.display='none'"></button>
        </div>
      </div>
    </div>
  {% endfor %}
{% endif %}
{% endblock %}